# Personal AI Employee — Silver Tier

An autonomous AI agent that monitors your Gmail and LinkedIn, drafts responses, and executes approved actions — without you touching the apps. Built on Claude Code + Obsidian as the shared brain.

```
Gmail / LinkedIn / Files
        ↓
  Watchers (Python, PM2)
        ↓
  vault/Needs_Action/
        ↓
  Planning Engine
        ↓
  vault/Pending_Approval/
        ↓
  You review → move to vault/Approved/
        ↓
  Approval Executor
        ↓
  Email sent / LinkedIn posted
        ↓
  vault/Done/ + audit log
```

---

## What It Does

| Capability | Detail |
|---|---|
| Gmail monitoring | Polls every 30s, detects unread + important emails |
| LinkedIn monitoring | Polls every 30s, detects new DMs and connection requests |
| File drop | Drop any file in `vault/Inbox/` → processed automatically |
| Risk classification | Classifies every item as high / medium / low risk |
| Draft generation | Writes a reply plan + approval request for every action |
| Human-in-the-loop | Nothing is sent without you approving it |
| Email sending | Sends via Gmail API after approval |
| LinkedIn posting | Posts via Playwright (headless Chromium) after approval |
| Audit trail | Every action logged to `vault/Logs/YYYY-MM-DD.jsonl` |

---

## Repository Structure

```
full_time_employee/
├── ecosystem.config.js          # PM2 config — 5 background processes
├── .env.example                 # Environment variable template
│
├── watchers/                    # Perception layer
│   ├── base_watcher.py          # Abstract base (retry, state persistence, logging)
│   ├── filesystem_watcher.py    # Watches vault/Inbox/ for dropped files
│   ├── gmail_watcher.py         # Polls Gmail API for unread+important emails
│   ├── linkedin_watcher.py      # Scrapes LinkedIn for DMs + connections
│   ├── auth_linkedin.py         # One-time LinkedIn session setup
│   └── requirements.txt         # Python dependencies
│
├── orchestrator/
│   └── planning_engine.py       # Reads Needs_Action/, writes Plans/ + approvals
│
├── config/
│   └── risk_config.yaml         # Tunable risk keywords (edit to change thresholds)
│
├── .claude/
│   ├── skills/
│   │   ├── approval-executor/   # Batch dispatcher — reads Approved/, runs actions
│   │   ├── gmail-sender/        # Send email via Gmail API
│   │   ├── linkedin-poster/     # Post to LinkedIn via Playwright
│   │   ├── vault-operator/      # Claude skill for reading/writing the vault
│   │   └── browsing-with-playwright/  # MCP browser automation server (22 tools)
│   └── hooks/
│       └── ralph_wiggum.py      # Stop hook — blocks exit if vault has pending work
│
├── vault/                       # Obsidian vault (shared state + human GUI)
│   ├── Dashboard.md             # Live status — updated after every session
│   ├── Company_Handbook.md      # Autonomy rules — what requires approval
│   ├── Inbox/                   # Drop files here to trigger processing
│   ├── Needs_Action/            # Watchers write here; planning engine reads
│   ├── Plans/                   # Plans generated by planning engine
│   ├── Pending_Approval/        # Awaiting your review
│   ├── Approved/                # Move files here to execute
│   ├── Rejected/                # Move files here to cancel
│   ├── Done/                    # Completed tasks (audit archive)
│   └── Logs/                    # JSONL audit logs + planning state
│
└── tests/                       # pytest test suite (62 tests)
    ├── conftest.py
    ├── test_planning_engine.py
    └── test_executor.py
```

---

## Setup (Fork & Run on Your Own System)

### Prerequisites

- Python 3.11+
- Node.js v18+
- A Gmail account with Google Cloud API access
- A LinkedIn account
- [Obsidian](https://obsidian.md) (optional but recommended as the vault GUI)

---

### Step 1 — Clone & Python environment

```bash
git clone https://github.com/your-username/full_time_employee.git
cd full_time_employee

python3 -m venv .venv
source .venv/bin/activate
pip install -r watchers/requirements.txt
pip install pyyaml python-dotenv playwright
playwright install chromium
```

---

### Step 2 — Install PM2

```bash
npm install pm2
```

Optional shorthand so you can type `pm2` directly:

```bash
ln -s "$(pwd)/node_modules/.bin/pm2" ~/.local/bin/pm2
```

---

### Step 3 — Gmail API credentials

1. Go to [Google Cloud Console](https://console.cloud.google.com)
2. Create a project → Enable **Gmail API**
3. Go to **APIs & Services → Credentials → Create Credentials → OAuth 2.0 Client ID**
4. Application type: **Desktop app**
5. Download the JSON file — save it somewhere safe (e.g. `~/.gmail_credentials.json`)

---

### Step 4 — Environment variables

```bash
cp .env.example .env
```

Edit `.env` with your values:

```env
GMAIL_CREDENTIALS=/absolute/path/to/your/credentials.json
LINKEDIN_SESSION_PATH=/absolute/path/to/full_time_employee/.sessions/linkedin
LINKEDIN_HEADLESS=true
```

---

### Step 5 — LinkedIn session (one-time login)

```bash
cd watchers
LINKEDIN_HEADLESS=false python auth_linkedin.py
```

A browser window opens. Log in to LinkedIn with your email and password (do not use Google Sign-In). Once logged in the session is saved to `.sessions/linkedin/` and reused automatically from that point forward.

---

### Step 6 — Gmail OAuth (one-time login)

The first time the Gmail watcher starts it will open a browser for the OAuth consent screen:

```bash
source .venv/bin/activate
python watchers/gmail_watcher.py vault
```

Authorise access in the browser. The token is saved to `watchers/.state/gmail_token.json` and reused automatically.

> The token must include both `gmail.readonly` and `gmail.send` scopes. The watcher requests both automatically — just make sure to grant both during the consent flow.

---

### Step 7 — Start all processes

```bash
pm2 start ecosystem.config.js
pm2 save
pm2 startup    # follow the printed sudo command to survive reboots
```

Verify everything is running:

```bash
pm2 list
```

You should see 5 processes all `online`:

| Name | Role | Interval |
|---|---|---|
| `watcher-filesystem` | Watches vault/Inbox/ | Event-driven |
| `watcher-gmail` | Polls Gmail API | Every 30s |
| `watcher-linkedin` | Scrapes LinkedIn | Every 30s |
| `planning-engine` | Processes Needs_Action/ | Every 30s |
| `approval-executor` | Executes Approved/ | Every 30s |

---

### Step 8 — Run tests

```bash
.venv/bin/python -m pytest tests/ -v
```

All 62 tests should pass.

---

### Step 9 — Open the vault in Obsidian (optional)

Point Obsidian at the `vault/` directory. `Dashboard.md` shows live counts and recent activity. `Pending_Approval/` is where you'll review and move approval files.

---

## Daily Workflow

### Automatic (nothing to do)

1. Email or LinkedIn message arrives
2. Watcher detects it within ~30 seconds
3. Planning engine drafts a reply and writes a file to `vault/Pending_Approval/`

### Your only job — approve or reject

Open `vault/Pending_Approval/` in Obsidian (or any file manager):

- **Approve:** move the file to `vault/Approved/` → executor sends it within 30 seconds
- **Reject:** move the file to `vault/Rejected/` → no action taken

---

## Sending Manually (Without a Trigger)

You can create approval files directly — no incoming message needed.

### Send a new email

Create a file in `vault/Approved/` (name it anything):

```markdown
---
type: approval_request
action: send_email
status: approved
---

# Payload

- **Target:** recipient@example.com
- **Subject / Title:** Your subject here

## Message / Content

  Hi,

  Your email body here.

  Best regards,
  Your Name
```

The executor sends it within 30 seconds.

### Post to LinkedIn

```markdown
---
type: approval_request
action: send_linkedin_post
status: approved
---

# Payload

- **Action:** `send_linkedin_post`
- **Target:** LinkedIn Feed
- **Subject / Title:** Post title (for your reference only)

## Message / Content

  Your post content here.

  #Hashtag1 #Hashtag2
```

> **The frontmatter block (`---`) at the top is required.** Without it the executor does not know the action type and skips the file.

---

## Configuration

### Risk thresholds

Edit `config/risk_config.yaml` to control what triggers human approval:

```yaml
high_risk:
  - lawsuit
  - fraud
  - hack
  # add keywords here...

medium_risk:
  - contract
  - invoice
  # add keywords here...

approval_triggers:
  # keywords that ALWAYS require approval regardless of risk level
  - send
  - payment
```

Restart after changes: `pm2 restart planning-engine`

### Autonomy rules

Edit `vault/Company_Handbook.md` to define what the agent can do without approval. Claude reads this file before every vault-operator session.

### Poll intervals

All processes default to 30 seconds. To change:

- `approval-executor` and `planning-engine`: edit the `--interval` arg in `ecosystem.config.js`
- `watcher-gmail`: edit `check_interval=30` in `watchers/gmail_watcher.py`
- `watcher-linkedin`: edit `_CHECK_INTERVAL = 30` in `watchers/linkedin_watcher.py`

Then restart: `pm2 restart all`

---

## Monitoring

```bash
pm2 list                               # process status overview
pm2 logs                               # tail all logs
pm2 logs watcher-gmail                 # tail one process
cat vault/Logs/$(date +%F).jsonl       # today's audit log (pretty-print with jq)
```

---

## Troubleshooting

| Problem | Fix |
|---|---|
| Nothing appearing in Needs_Action | Check `pm2 logs watcher-gmail` — likely a credentials or token issue |
| Approval file not being sent | Check the file has YAML frontmatter with `action:` and `status: approved` |
| Gmail `invalid_scope` error | Delete `watchers/.state/gmail_token.json`, restart `watcher-gmail`, re-authorise |
| LinkedIn session expired | Re-run `LINKEDIN_HEADLESS=false python watchers/auth_linkedin.py` |
| LinkedIn post times out | Normal — the `networkidle` fix is already applied; if it still fails check `pm2 logs approval-executor` |
| PM2 process keeps restarting | `pm2 logs <name>` to see the error; usually a missing env var or bad path in `.env` |

---

## Tech Stack

- **[Claude Code](https://claude.ai/code)** — Reasoning engine and orchestrator
- **[Obsidian](https://obsidian.md)** — Local-first vault as shared state and human GUI
- **[Gmail API](https://developers.google.com/gmail/api)** — Email read + send (OAuth 2.0)
- **[Playwright](https://playwright.dev)** — LinkedIn browser automation (persistent session)
- **[PM2](https://pm2.keymetrics.io)** — Process manager (keep-alive, auto-restart, startup)
- **Python 3.11+** — All watcher and orchestrator scripts
- **Node.js v18+** — PM2 runtime

---

## Security

- Never commit `.env` — it is already in `.gitignore`
- Session data (`.sessions/`) is excluded from git
- All outbound actions require human approval — nothing is sent autonomously
- Every action is logged to `vault/Logs/YYYY-MM-DD.jsonl` for audit purposes

---

## License

MIT
